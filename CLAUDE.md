# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is an MCP (Model Context Protocol) server that provides advanced AI capabilities including web search and code execution using OpenAI's models. The project exposes a single `iris` tool that accepts natural language queries and can perform web searches, high-precision reasoning, and code execution depending on the specified parameters.

**Current Version: 0.4.0**

## Architecture

- **Single-file TypeScript server** (`src/index.ts`) - Contains the entire MCP server implementation
- **MCP SDK integration** - Uses `@modelcontextprotocol/sdk` for server framework  
- **OpenAI Integration** - Supports both gpt-5 (default) and o3 models with optional code interpreter
- **Environment-based configuration** - Uses env vars for API key and search parameters
- **Dynamic tool construction** - Web search + optional code interpreter based on parameters

## Development Commands

Build the project:
```bash
npm run build
```

The build process compiles TypeScript to JavaScript in the `server/` directory and makes the output executable.

Run integration tests:
```bash
npm run test:integration
```

Run tests using Makefile:
```bash
make test
```

Clean build artifacts:
```bash
make clean
```

Check project status:
```bash
make status
```

## Key Environment Variables

- `OPENAI_API_KEY` - Required OpenAI API key
- `.env` - Place environment variables in `.env` file for local testing

## Testing

The project includes an integration test that:
- Validates OPENAI_API_KEY environment variable
- Starts the MCP server process
- Tests MCP protocol initialization
- Verifies tool registration and execution

Integration test requires:
- OPENAI_API_KEY in environment or `.env` file
- Built server (`npm run build` first)

## Project Structure

- `src/index.ts` - Main server implementation with iris tool
- `server/` - Compiled JavaScript output (generated by build)
- `test/integration.test.js` - Integration test for MCP protocol
- `Makefile` - Build and publish automation commands
- `tsconfig.json` - TypeScript configuration with strict settings

## Implementation Details

The server implements sophisticated error handling and response processing:
- **Model Selection**: Validates and switches between gpt-5 and o3 models (src/index.ts:49)
- **Dynamic Tool Construction**: Builds tool arrays based on parameters (src/index.ts:57)
- **Error Handling**: Comprehensive error categorization for different failure types (src/index.ts:73)
- **Response Processing**: Handles complex OpenAI response structures including code interpreter results (src/index.ts:88)

## MCP Tool Implementation

The server exposes a single `iris` tool that supports:
- Web search with configurable context size
- Model selection (gpt-5 recommended, o3 available)  
- Optional code interpreter for data analysis
- Configurable reasoning effort levels

## Versioning

バージョン情報の更新時は以下のファイルを同期して更新:
- `src/index.ts` (line 40)
- `package.json` (version field)
- `CLAUDE.md` (current version: 0.3.0)